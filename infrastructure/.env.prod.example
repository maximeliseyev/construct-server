# ============================================================================
# Construct Server - Production Environment Configuration
# ============================================================================
# Copy this file to .env.prod and fill in the values
# DO NOT commit .env.prod to version control

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
DATABASE_URL=postgresql://construct:${DB_PASSWORD}@postgres:5432/construct

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================
REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379

# ============================================================================
# JWT CONFIGURATION
# ============================================================================
JWT_SECRET=${JWT_SECRET}
JWT_ISSUER=prod-construct-
ACCESS_TOKEN_TTL_MINUTES=60
REFRESH_TOKEN_TTL_DAYS=30

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================
RUST_LOG=info
INSTANCE_DOMAIN=${DOMAIN_NAME}
FEDERATION_BASE_DOMAIN=${DOMAIN_NAME}
FEDERATION_ENABLED=false
DEEP_LINK_BASE_URL=https://${DOMAIN_NAME}

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================
# Rate Limiting
MAX_MESSAGES_PER_HOUR=1000
MAX_KEY_ROTATIONS_PER_DAY=10
MAX_PASSWORD_CHANGES_PER_DAY=5
MAX_FAILED_LOGIN_ATTEMPTS=5
MAX_CONNECTIONS_PER_USER=5

# Cryptography
APNS_DEVICE_TOKEN_ENCRYPTION_KEY=${APNS_DEVICE_TOKEN_ENCRYPTION_KEY}

# ============================================================================
# MESSAGE CONFIGURATION
# ============================================================================
MESSAGE_TTL_DAYS=7
PREKEY_TTL_DAYS=30
PREKEY_MIN_TTL_DAYS=7
PREKEY_MAX_TTL_DAYS=90

# ============================================================================
# DELIVERY WORKER CONFIGURATION
# ============================================================================
ONLINE_CHANNEL=user_online_notifications:
DELIVERY_QUEUE_PREFIX=delivery_queue:
OFFLINE_QUEUE_PREFIX=offline:
DELIVERY_POLL_INTERVAL_MS=10000

# ============================================================================
# KAFKA CONFIGURATION (Optional - for production messaging)
# ============================================================================
KAFKA_ENABLED=true
KAFKA_PRODUCER_COMPRESSION=snappy
KAFKA_PRODUCER_LINGER_MS=5
KAFKA_PRODUCER_ACKS=all
KAFKA_TOPIC=construct-messages
KAFKA_CONSUMER_GROUP=construct-delivery-workers
KAFKA_BROKERS=${KAFKA_BROKERS}
KAFKA_SSL_ENABLED=true
KAFKA_SASL_MECHANISM=PLAIN
KAFKA_SASL_USERNAME=${KAFKA_SASL_USERNAME}
KAFKA_SASL_PASSWORD=${KAFKA_SASL_PASSWORD}

# ============================================================================
# MICROSERVICES CONFIGURATION
# ============================================================================
MICROSERVICES_ENABLED=true
AUTH_SERVICE_URL=http://auth-service:8001
MESSAGING_SERVICE_URL=http://messaging-service:8002
USER_SERVICE_URL=http://user-service:8003
NOTIFICATION_SERVICE_URL=http://notification-service:8004
SERVICE_TIMEOUT_SECS=30
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_SUCCESS_THRESHOLD=2
CIRCUIT_BREAKER_TIMEOUT_SECS=60
SERVICE_DISCOVERY_MODE=static

# ============================================================================
# MONITORING & LOGGING
# ============================================================================
LOG_MESSAGE_METADATA=false
LOG_USER_IDENTIFIERS=false
LOG_HASH_SALT=${LOG_HASH_SALT}

# ============================================================================
# OPTIONAL: Key Management System (Vault)
# ============================================================================
# VAULT_ADDR=https://vault.example.com:8200
# VAULT_TOKEN=${VAULT_TOKEN}
# KEY_ROTATION_INTERVAL_HOURS=24

# ============================================================================
# OPTIONAL: APNs (Apple Push Notifications)
# ============================================================================
# APNS_ENABLED=true
# APNS_ENVIRONMENT=production
# APNS_KEY_ID=${APNS_KEY_ID}
# APNS_TEAM_ID=${APNS_TEAM_ID}
# APNS_BUNDLE_ID=com.example.construct

# ============================================================================
# OPTIONAL: Federation (Cross-server messaging)
# ============================================================================
# FEDERATION_ENABLED=true
# FEDERATION_PRIVATE_KEY_SEED=${FEDERATION_PRIVATE_KEY_SEED}