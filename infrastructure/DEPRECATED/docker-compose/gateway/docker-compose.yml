version: '3.8'

services:
  gateway:
    image: construct-server:latest
    command: gateway
    ports:
      - "8080:8080"
    environment:
      - RUST_LOG=info
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - JWT_PUBLIC_KEY=${JWT_PUBLIC_KEY}
      - CSRF_SECRET=${CSRF_SECRET}
      - AUTH_SERVICE_URL=http://auth-service:8080
      - MESSAGING_SERVICE_URL=http://messaging-service:8080
      - USER_SERVICE_URL=http://user-service:8080
      - NOTIFICATION_SERVICE_URL=http://notification-service:8080
    depends_on:
      - auth-service
      - messaging-service
      - user-service
      - notification-service
    networks:
      - construct-network
    restart: unless-stopped

networks:
  construct-network:
    driver: bridge
