# =============================================================================
# Construct Server — Bootstrap Environment Variables
# =============================================================================
# These are NON-SECRET config vars that control the deployment.
# Actual secrets (DB credentials, JWT keys, API keys) are stored in Vault.
#
# Copy to repo root: cp ops/.env.example .env
# =============================================================================

# ─── Domain ──────────────────────────────────────────────────────────────────
INSTANCE_DOMAIN=your-domain.com

# ─── Traefik ─────────────────────────────────────────────────────────────────
# Email for Let's Encrypt certificate notifications
ACME_EMAIL=your@email.com

# Cloudflare API token for DNS-01 ACME challenge (required when using Cloudflare Proxy).
# Create at: https://dash.cloudflare.com/profile/api-tokens
# Permissions needed: Zone → DNS → Edit  (scoped to your zone only)
CLOUDFLARE_DNS_API_TOKEN=your-cloudflare-api-token-here

# Basic auth for Traefik dashboard
# Generate: docker run --rm httpd:alpine htpasswd -nBb admin YOUR_PASSWORD
# Escape $ as $$ in .env files!
TRAEFIK_DASHBOARD_AUTH=admin:$$2y$$05$$CHANGE_ME_HASH_HERE

# ─── CORS ─────────────────────────────────────────────────────────────────────
# Allowed origins for gRPC-web CORS (comma-separated or *)
CORS_ALLOWED_ORIGINS=*

# ─── App Config (non-secret) ──────────────────────────────────────────────────
RUST_LOG=info,sqlx=warn
IMAGE_TAG=latest

APNS_ENABLED=false
APNS_ENVIRONMENT=production

MAX_MESSAGES_PER_HOUR=1000
MESSAGE_TTL_DAYS=7

DELIVERY_ACK_MODE=at_least_once
DELIVERY_EXPIRY_DAYS=7
DELIVERY_QUEUE_PREFIX=delivery
OFFLINE_QUEUE_PREFIX=offline
ONLINE_CHANNEL=online

KAFKA_ENABLED=false
KAFKA_BROKERS=64.227.67.1:19092
KAFKA_SASL_MECHANISM=PLAIN
KAFKA_SSL_ENABLED=false
KAFKA_CONSUMER_GROUP=construct-delivery
KAFKA_TOPIC=messages
KAFKA_PRODUCER_ACKS=all
KAFKA_PRODUCER_COMPRESSION=none

# =============================================================================
# Monitoring
# =============================================================================
# Grafana admin password (change this!)
GRAFANA_ADMIN_PASSWORD=change_me_please

# =============================================================================
# Secrets are stored in Vault, NOT here.
# After first deploy, run:
#   docker compose -f ops/docker-compose.prod.yml exec vault \
#     sh /vault/scripts/vault-setup.sh
# =============================================================================
