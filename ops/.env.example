# =============================================================================
# Construct Server — Production Environment Variables
# =============================================================================
# Copy this file to the repo root: cp ops/.env.example .env
# Fill in all required values. NEVER commit .env to git.
# =============================================================================

# ─── Domain ──────────────────────────────────────────────────────────────────
INSTANCE_DOMAIN=your-domain.com

# ─── Database (local PostgreSQL container) ───────────────────────────────────
DB_USER=construct
DB_PASSWORD=CHANGE_ME_strong_password_here
DB_NAME=construct
# Full URL is built automatically in docker-compose from above values
# If using DigitalOcean Managed Postgres, set this directly:
# DATABASE_URL=postgresql://user:pass@host:25060/dbname?sslmode=require

# ─── Redis (local Redis container) ───────────────────────────────────────────
REDIS_PASSWORD=CHANGE_ME_redis_password_here
# If using DigitalOcean Managed Redis, set this directly:
# REDIS_URL=rediss://default:pass@host:25061

# ─── JWT ─────────────────────────────────────────────────────────────────────
# Generate: openssl genrsa -out private.pem 2048 && openssl rsa -in private.pem -pubout -out public.pem
JWT_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----
REPLACE_WITH_YOUR_PRIVATE_KEY
-----END RSA PRIVATE KEY-----"

JWT_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----
REPLACE_WITH_YOUR_PUBLIC_KEY
-----END PUBLIC KEY-----"

JWT_ISSUER=construct-auth

# ─── Signing & Security ───────────────────────────────────────────────────────
# Generate: openssl rand -hex 32
SERVER_SIGNING_KEY=CHANGE_ME_64_char_hex_string
CSRF_SECRET=CHANGE_ME_32_char_secret
MEDIA_HMAC_SECRET=CHANGE_ME_media_secret
LOG_HASH_SALT=CHANGE_ME_log_salt

# ─── Rate limits ─────────────────────────────────────────────────────────────
MAX_MESSAGES_PER_HOUR=1000
MESSAGE_TTL_DAYS=7

# ─── Delivery Worker ─────────────────────────────────────────────────────────
DELIVERY_SECRET_KEY=CHANGE_ME_delivery_secret
DELIVERY_ACK_MODE=at_least_once
DELIVERY_EXPIRY_DAYS=7
DELIVERY_QUEUE_PREFIX=delivery
OFFLINE_QUEUE_PREFIX=offline
ONLINE_CHANNEL=online

# ─── APNs (Apple Push Notifications) ─────────────────────────────────────────
APNS_ENABLED=false
APNS_ENVIRONMENT=production
APNS_BUNDLE_ID=com.yourcompany.construct
APNS_KEY_ID=YOUR_KEY_ID
APNS_TEAM_ID=YOUR_TEAM_ID
APNS_TOPIC=com.yourcompany.construct
APNS_DEVICE_TOKEN_ENCRYPTION_KEY=CHANGE_ME_apns_encryption_key
# APNS private key (.p8 content):
# APNS_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"

# ─── Kafka (optional, set KAFKA_ENABLED=false to skip) ───────────────────────
KAFKA_ENABLED=false
KAFKA_BROKERS=
KAFKA_SASL_USERNAME=
KAFKA_SASL_PASSWORD=
KAFKA_SASL_MECHANISM=PLAIN
KAFKA_SSL_ENABLED=false
KAFKA_CONSUMER_GROUP=construct-delivery
KAFKA_TOPIC=messages
KAFKA_PRODUCER_ACKS=1
KAFKA_PRODUCER_COMPRESSION=none

# ─── Logging ─────────────────────────────────────────────────────────────────
RUST_LOG=info,sqlx=warn

# ─── Docker image tag ────────────────────────────────────────────────────────
IMAGE_TAG=latest
