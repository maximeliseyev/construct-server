# ============================================================================
# Construct Server - Local/Test Environment Configuration
# ============================================================================
# Copy this file to .env.test and fill in your values
# cp .env.test.example .env.test

# ============================================================================
# Database Configuration
# ============================================================================
# For local testing, use localhost postgres (see docker-compose.dev.yml)
DATABASE_URL=postgresql://postgres:password@localhost:5432/construct_test

# Or use your existing test database
# DATABASE_URL=postgresql://postgres:qoqjug-simpu7-qoVsin@db.fyeswytcztcsdsruxxsh.supabase.co:5432/postgres

# ============================================================================
# Redis Configuration
# ============================================================================
# For local testing
REDIS_URL=redis://localhost:6379

# Or use Upstash test instance
# REDIS_URL=rediss://default:password@your-redis.upstash.io:6379

# ============================================================================
# JWT Configuration
# ============================================================================
# Use local test keys
JWT_PRIVATE_KEY=./prkeys/jwt_private_key.pem
JWT_PUBLIC_KEY=./prkeys/jwt_public_key.pem
JWT_ISSUER=construct-test

# ============================================================================
# CSRF Protection
# ============================================================================
# Generate: openssl rand -hex 32
CSRF_SECRET=test_csrf_secret_replace_with_32_char_minimum_random_string

# ============================================================================
# Server Ports
# ============================================================================
PORT=8080
HEALTH_PORT=8081

# ============================================================================
# Logging
# ============================================================================
RUST_LOG=debug,sqlx=warn,tower_http=info

# ============================================================================
# Security & Crypto Keys
# ============================================================================
# Generate these locally: openssl rand -hex 32
DELIVERY_SECRET_KEY=a16cda790fc6c4eb031f1b552f2fb8839c3d0bbf999bc54d0de5bbaf6149dc21
MEDIA_HMAC_SECRET=925adaccd852f1e95bfdfba9f620f51951e41e25c4a3ccebf2d4adbea4a6c378
SERVER_SIGNING_KEY=g7P/rMDwefyMZ+axIHxYFLriZ3tNco9mmZd0HuC89nU=
LOG_HASH_SALT=2796127d573655228a0f9533cb6f1528f83b3462bbf4ad9911b9dfc0b98d653c

# ============================================================================
# TTL Configuration
# ============================================================================
MESSAGE_TTL_DAYS=7
SESSION_TTL_DAYS=30
REFRESH_TOKEN_TTL_DAYS=90

# ============================================================================
# Rate Limiting
# ============================================================================
MAX_MESSAGES_PER_HOUR=1000
MAX_KEY_ROTATIONS_PER_DAY=10
MAX_PASSWORD_CHANGES_PER_DAY=5
MAX_FAILED_LOGIN_ATTEMPTS=5
MAX_CONNECTIONS_PER_USER=5

# ============================================================================
# Kafka Configuration (Optional for local testing)
# ============================================================================
KAFKA_ENABLED=false
# KAFKA_BROKERS=localhost:9092
# KAFKA_TOPIC=construct-messages-test
# KAFKA_CONSUMER_GROUP=delivery-workers-test

# If using remote Kafka:
# KAFKA_ENABLED=true
# KAFKA_BROKERS=kafka.konstruct.cc:9092
# KAFKA_SASL_USERNAME=test_user
# KAFKA_SASL_PASSWORD=test_password
# KAFKA_SSL_ENABLED=true
# KAFKA_SASL_MECHANISM=SCRAM-SHA-256

# ============================================================================
# APNS Configuration (Optional for local testing)
# ============================================================================
APNS_ENABLED=false
# APNS_ENVIRONMENT=development
# APNS_KEY_PATH=prkeys/AuthKey_TKYQ5KVW7P.p8
# APNS_KEY_ID=TKYQ5KVW7P
# APNS_TEAM_ID=PK2473XF3P
# APNS_BUNDLE_ID=maximeliseyev.constructmessenger
APNS_DEVICE_TOKEN_ENCRYPTION_KEY=0000000000000000000000000000000000000000000000000000000000000000

# ============================================================================
# Federation & Domain Configuration
# ============================================================================
INSTANCE_DOMAIN=localhost
FEDERATION_BASE_DOMAIN=localhost
FEDERATION_ENABLED=false
ENABLE_MESSAGE_GATEWAY=false
DEEP_LINK_BASE_URL=http://localhost:8080

# ============================================================================
# Delivery Configuration
# ============================================================================
DELIVERY_ACK_MODE=database
DELIVERY_ACK_ENABLE_BATCHING=false
DELIVERY_EXPIRY_DAYS=7
DELIVERY_CLEANUP_INTERVAL_SECS=3600

# ============================================================================
# Logging Privacy
# ============================================================================
LOG_MESSAGE_METADATA=true
LOG_USER_IDENTIFIERS=true
