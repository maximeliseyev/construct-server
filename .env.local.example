# ============================================================================
# Local Development Configuration
# ============================================================================
# This file contains configuration for local Docker development.
# Copy to .env.local and customize as needed.
#
# DO NOT commit this file with real secrets!
# ============================================================================

# ============================================================================
# JWT Configuration (Local Development)
# ============================================================================
# For local dev, you can use the same keys as in .env or generate test keys
JWT_PRIVATE_KEY=prkeys/jwt_private_key.pem
JWT_PUBLIC_KEY=prkeys/jwt_public_key.pem
JWT_ISSUER=construct-server-local

# ============================================================================
# Database (Docker)
# ============================================================================
DATABASE_URL=postgresql://construct:construct_dev_password@localhost:5432/construct

# ============================================================================
# Redis (Docker)
# ============================================================================
REDIS_URL=redis://localhost:6379

# ============================================================================
# Kafka/Redpanda Configuration
# ============================================================================
# Option 1: Local Kafka (Docker) - default for development
KAFKA_ENABLED=true
KAFKA_BROKERS=localhost:9092
KAFKA_TOPIC=construct-messages
KAFKA_CONSUMER_GROUP=delivery-workers-local
KAFKA_SSL_ENABLED=false
KAFKA_SASL_MECHANISM=
KAFKA_SASL_USERNAME=
KAFKA_SASL_PASSWORD=

# Option 2: Remote Redpanda (VPS) - uncomment to use production Redpanda
# KAFKA_ENABLED=true
# KAFKA_BROKERS=d5ohc4qn5b4at65p6360.any.eu-central-1.mpx.prd.cloud.redpanda.com:9092
# KAFKA_TOPIC=construct-messages
# KAFKA_CONSUMER_GROUP=delivery-workers-local
# KAFKA_SSL_ENABLED=true
# KAFKA_SASL_MECHANISM=SCRAM-SHA-256
# KAFKA_SASL_USERNAME=CONSTRUCT_MESSENGER_BROKER
# KAFKA_SASL_PASSWORD=jDOE(-tOSFSktSLW)ll+k5nfUE1lEC

# Kafka Producer Settings
KAFKA_PRODUCER_COMPRESSION=snappy
KAFKA_PRODUCER_ACKS=all
KAFKA_PRODUCER_LINGER_MS=5
KAFKA_PRODUCER_ENABLE_IDEMPOTENCE=false

# ============================================================================
# Security & Hashing
# ============================================================================
LOG_HASH_SALT=local_dev_salt_not_for_production_use_only
CSRF_SECRET=local_dev_csrf_secret_32_characters_minimum_required

# ============================================================================
# Redis Channels & Queues
# ============================================================================
ONLINE_CHANNEL=user:online
DELIVERY_QUEUE_PREFIX=messages
OFFLINE_QUEUE_PREFIX=offline

# ============================================================================
# Media Service
# ============================================================================
MEDIA_HMAC_SECRET=local_dev_hmac_secret_not_for_production
MEDIA_STORAGE_DIR=/tmp/construct-media
MEDIA_MAX_FILE_SIZE=104857600  # 100MB
MEDIA_FILE_TTL_SECONDS=604800  # 7 days

# ============================================================================
# APNs Configuration (Disabled for local dev)
# ============================================================================
APNS_ENABLED=false
APNS_DEVICE_TOKEN_ENCRYPTION_KEY=0000000000000000000000000000000000000000000000000000000000000000
APNS_ENVIRONMENT=development

# ============================================================================
# Logging
# ============================================================================
RUST_LOG=debug,sqlx=warn,rdkafka=info

# ============================================================================
# Server Ports (when running services directly, not in Docker)
# ============================================================================
PORT=8080
HEALTH_PORT=8081

# ============================================================================
# CSRF Protection
# ============================================================================
CSRF_ENABLED=false  # Disabled for services behind API Gateway

# ============================================================================
# Rate Limiting
# ============================================================================
MAX_LONG_POLL_REQUESTS_PER_WINDOW=100
LONG_POLL_RATE_LIMIT_WINDOW_SECS=60

# ============================================================================
# TTL Configuration
# ============================================================================
MESSAGE_TTL_DAYS=7
SESSION_TTL_DAYS=30
REFRESH_TOKEN_TTL_DAYS=90

# ============================================================================
# Delivery ACK (optional)
# ============================================================================
DELIVERY_ACK_MODE=disabled
# DELIVERY_SECRET_KEY=
# DELIVERY_EXPIRY_DAYS=7
